name: Keep Replicate Model Warm

on:
  schedule:
    # Run every 9 minutes (Replicate cold boots after ~10-15 mins)
    - cron: '*/9 * * * *'
  workflow_dispatch: # Adds a "Run Now" button in GitHub for testing

jobs:
  wake-up-gpu:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Replicate
        env:
          REPLICATE_API_TOKEN: ${{ secrets.REPLICATE_API_TOKEN }}
        run: |
          echo "Pinging Replicate to wake up GPU..."
          curl -X POST \
            -H "Authorization: Token ${{ secrets.REPLICATE_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "version": "104b4a39315349db50880757bc8c1c996c5309e3aa11286b0a3c84dab81fd440",
              "input": {
                "source": "https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4",
                "target": "https://avatars.githubusercontent.com/u/1"
              }
            }' \
            https://api.replicate.com/v1/predictions
